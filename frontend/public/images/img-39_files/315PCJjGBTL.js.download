'use strict';mix_d("MorpheusPopularityRankSidesheetCards__morpheus-popularity-rank-sidesheet-card:morpheus-popularity-rank-sidesheet-card__PeNkHnjC","exports tslib @c/browser-operations @c/logger @c/metrics @c/scoped-dom @p/monarch-sidesheet @c/remote-operations".split(" "),function(A,v,J,K,h,L,M,N){function n(a){return a&&"object"===typeof a&&"default"in a?a:{"default":a}}var O=n(J),u=n(K),g=n(L),l=n(M),B=n(N),w;(function(a){a.asinItemClickMetricReportHandler="asinItemClickMetricReportHandler";a.aodLinkClickHandler=
"aodLinkClickHandler"})(w||(w={}));var C=w,x=function(a){var b=0,e=setInterval(function(){5<b&&clearInterval(e);b++;var c=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_header__1CUj_")[0],d=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_alert-message__3I7G9")[0];if(c||d)clearInterval(e),a.focus()},500)},D=function(a){var b=0,e=setInterval(function(){5<b&&clearInterval(e);b++;var c=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_item_link__1pKM-")[0];
c&&(clearInterval(e),c.focus())},500)},E=function(a){var b=g["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_err-view__V9B13")[0];a&&b&&(a.innerHTML=b.innerHTML)},m=function(a){a&&(a.style.display="none")},q=function(a,b){return b?a+"T1":a+"C"},F=new Map([["kindle_meta_binding","Kin"],["audiobooks_digital_meta_binding","Aud"],["hardcover_meta_binding","Hrd"],["paperback_meta_binding","Pap"],["mass_market_paperback_meta_binding","Mmp"],["audiobooks_meta_binding",
"Abk"]]),G=function(a){return F.has(a)?"morpheusSidesheetTabClicked"+F.get(a):"morpheusSidesheetTabClickedOther"},r,t=function(){var a;return 0<(null===(a=g["default"].cardRoot.getElementsByClassName("isPopularityWeblabEnabled"))||void 0===a?void 0:a.length)},R=function(a){a.preventDefault();var b=g["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_sidesheet__R6-h1")[0],e=g["default"].cardRoot.getElementsByClassName("landingAsinValue")[0];if(b&&e){a=g["default"].cardRoot.getElementsByClassName("sidesheetMainBody")[0];
!r&&a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_alert-message__3I7G9")[0]&&l["default"].setContent("");var c=Date.now();h.count("seeAllFormatsExpanderClicked",1);h.count(q("seeAllFormatsExpanderClicked",t()),1);l["default"].show();if(r)x(b);else{var d=g["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_content-ctr__jbXAx")[0],y=function(){l["default"].setContent(d.innerHTML);P(b);Q(b);var a=O["default"].setup().define;a(C.asinItemClickMetricReportHandler,
"click",function(a){var b,c,f,e;a=a.target.parentElement;var d="true"===(null===(b=null===a||void 0===a?void 0:a.dataset)||void 0===b?void 0:b.newRelease);b="true"===(null===(c=null===a||void 0===a?void 0:a.dataset)||void 0===c?void 0:c.popularityEnabled);d&&h.count(b?"morpheusNewReleasedItemClickedWithBadge":"morpheusNewReleasedItemClickedNoBadge",1);h.count("morpheusEditionItemClicked",1);h.count(q("morpheusEditionItemClicked",t()),1);c="true"===(null===(f=null===a||void 0===a?void 0:a.dataset)||
void 0===f?void 0:f.isPopular);f="true"===(null===(e=null===a||void 0===a?void 0:a.dataset)||void 0===e?void 0:e.isPopularBadgeWeblabEnabled);c&&b&&h.count(f?"morpheusPopularItemClickedWithBadge":"morpheusPopularItemClickedNoBadge",1)});a(C.aodLinkClickHandler,"click",function(a){var b;a=a.target;a.classList.contains("morpheusAodEntryLink")&&!a.classList.contains("morpheusAodDeclarativeAction")&&(l["default"].closeSidesheet(a.id),a=null===(b=a.parentElement)||void 0===b?void 0:b.getElementsByClassName("morpheusAodDeclarativeAction")[0])&&
(a.click(),h.count("morpheusAODClicked",1),h.count(q("morpheusAODClicked",t()),1))});a=b.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_tab-content__37vVR");for(var k=0;k<a.length;k++)a[k].getElementsByClassName("sidesheetAsinListContainer")[0]&&I(e.value,a[k]);a=Date.now()-c;h.count("morpheusSidesheetContentLoadLatency",a);r=!0};B["default"].setup().getSidesheetHtml({asin:e.value}).then(function(a){d&&(d.innerHTML=a.outerHTML,y(),x(b))}).catch(function(a){E(d);l["default"].setContent(d.innerHTML);
r=!1;h.count("failedRenderSidesheetContent",1);x(b);u["default"].log("Experiencing some issues to load sidesheet view for ASIN "+e.value+", trace: "+a,"ERROR")})}}else u["default"].log("Not able to open see all formats sidesheet, missing neccessary component.","FATAL")},z=function(a,b,e,c){var d=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_tab-content-spinner__3lJtW")[0],y=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_alert-message__3I7G9")[0],
g=a.getElementsByClassName("sidesheetAsinListContainer")[0];m(g);m(y);d&&(d.style.display="inline-block");B["default"].setup().getMetabindingTabContentHtml({asin:b,totalPageNumber:e,currentPageNumber:c?c:1}).then(function(c){a.innerHTML=c.innerHTML;I(b,a,e);D(a)}).catch(function(b){E(a);m(d);a.innerHTML+=d.outerHTML;h.count("failedRenderMetabindingTabContent",1);u["default"].log("Experiencing some issues to load tab content view, trace: "+b,"ERROR")})},P=function(a){var b=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_tab-item__2zc-Z"),
e=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_tab-content__37vVR"),c=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_active__3v2zd")[0];c=null===c||void 0===c?void 0:c.getElementsByClassName("metabindingSymbol")[0];"audiobooks_digital_meta_binding"===(null===c||void 0===c?void 0:c.value)&&(h.count("seeAllFormatsExpanderClickedAud",1),a.getElementsByClassName("isLoggedInCustomer")[0]&&h.count("seeAllFormatsExpanderClickedAudLoggedIn",1));c=function(c){var d=
e[c].getElementsByClassName("a-box-inner")[0];d&&(d.style.padding="0");b[c].addEventListener("click",function(){var d=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_active__3v2zd")[0];if(d!==b[c]){var f=b[c].getElementsByClassName("metabindingSymbol")[0];f&&f.value&&(h.count(G(f.value),1),h.count(q(G(f.value),t()),1),"audiobooks_digital_meta_binding"===f.value&&a.getElementsByClassName("isLoggedInCustomer")[0]&&h.count("morpheusSidesheetTabClickedAudLoggedIn",1));b[c].className=
"_morpheus-popularity-rank-sidesheet-card_ss_tab-item__2zc-Z _morpheus-popularity-rank-sidesheet-card_ss_active__3v2zd";d.className="_morpheus-popularity-rank-sidesheet-card_ss_tab-item__2zc-Z";d=e[c];if((f=d.getElementsByClassName("sidesheetAsinListContainer")[0])&&"none"!==f.style.display)D(d);else{f=b[c].getElementsByClassName("winningAsin")[0];var g=b[c].getElementsByClassName("totalPages")[0];z(d,f.value,Number(g.value))}}})};for(var d=0;d<b.length;d++)c(d)},Q=function(a){var b=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_tab-row__1Uxai")[0],
e=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_scroll-back__2cqlo")[0],c=a.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_scroll-forw__2NDFi")[0];if(e&&c&&b){var d=e.offsetLeft>c.offsetLeft;d&&(e.classList.remove("_morpheus-popularity-rank-sidesheet-card_ss_scroll-back-radius__2TGra"),c.classList.remove("_morpheus-popularity-rank-sidesheet-card_ss_scroll-forw-radius__3O1Mg"));var h=!1,g=d&&3<b.scrollLeft,k;m(e);var f=function(){return g?3>=Math.abs(b.scrollLeft):
3>=b.scrollWidth-Math.abs(b.scrollLeft)-b.offsetWidth},H=function(){return g?3>=b.scrollWidth-Math.abs(b.scrollLeft)-b.offsetWidth:3>=Math.abs(b.scrollLeft)};f()&&m(c);b.addEventListener("scroll",function(){f()&&"none"!==c.style.display?(m(c),clearInterval(k)):!f()&&"none"===c.style.display&&c&&(c.style.display="inline-block");H()&&"none"!==e.style.display?(m(e),clearInterval(k)):!H()&&"none"===e.style.display&&e&&(e.style.display="inline-block")});c.addEventListener("mousedown",function(){k=setInterval(function(){var a=
b.scrollLeft;d&&!h?b.scrollLeft-=3:b.scrollLeft+=3;d&&!h&&0===a&&0===b.scrollLeft&&(h=!0,b.scrollLeft+=3)},10)});c.addEventListener("mouseup",function(){clearInterval(k)});e.addEventListener("mousedown",function(){k=setInterval(function(){d&&!h?b.scrollLeft+=3:b.scrollLeft-=3},10)});e.addEventListener("mouseup",function(){clearInterval(k)})}},I=function(a,b,e){for(var c=b.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ss_pagination__4GE1X")[0],d=b.getElementsByClassName("a-pagination")[0].getElementsByTagName("li"),
g=function(g){var f=d[g];f.classList.contains("a-disabled")||f.addEventListener("click",function(k){k.preventDefault();k=f&&f.classList.contains("a-selected");var p;0===g&&c.dataset.prevPageNumber?p=Number(c.dataset.prevPageNumber):g===d.length-1&&c.dataset.nextPageNumber?p=Number(c.dataset.nextPageNumber):f&&f.dataset.pageNumber&&(p=Number(f.dataset.pageNumber));f&&!k&&p&&(h.count("morpheusSidesheetOtherPageNavigated",1),h.count(q("morpheusSidesheetOtherPageNavigated",t()),1),e?z(b,a,e,p):(k=d[d.length-
2])&&k.dataset.pageNumber&&z(b,a,Number(k.dataset.pageNumber),p))})},l=0;l<d.length;l++)g(l)};A._operationNames=["getSidesheetHtml","getMetabindingTabContentHtml"];A.card=function(){return v.__awaiter(void 0,void 0,void 0,function(){var a,b,e,c,d,h,m,k,f;return v.__generator(this,function(n){a=g["default"].cardRoot.getElementsByClassName("morpheusRoot")[0];if(!a)return[2];e=(b=g["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_saf__39PV9")[0])?b:g["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_saf-link__2TS-U")[0];
c=g["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_sidesheet__R6-h1")[0];d=g["default"].cardRoot.getElementsByClassName("sidesheetMainBody")[0];h=g["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_overlay__T88OB")[0];m=g["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_spinner__VHgKZ")[0];k=g["default"].cardRoot.getElementsByClassName("_morpheus-popularity-rank-sidesheet-card_ingress_sidesheet-close__13oI1")[0];
f=[c,d,h,m,k];if(f.every(function(a){return a})&&f.map(function(a){return a.id}).every(function(a){return a}))l["default"].initialize.apply(l["default"],v.__spread(f.map(function(a){return a.id}))),k.tabIndex=0;else return u["default"].log("Not able to initialize see all formats sidesheet, missing neccessary component or component id.","FATAL"),[2];r=!1;e&&e.addEventListener("click",R);return[2]})})}});
